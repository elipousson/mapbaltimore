<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mapbaltimore">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/5/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Get areas and data to layer on a map • mapbaltimore</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get areas and data to layer on a map">
<meta property="og:description" content="mapbaltimore">
<meta property="og:image" content="https://elipousson.github.io/mapbaltimore/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/5/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mapbaltimore</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/extdata_cachedata.html">External, cached, and remote data sources</a>
    <a class="dropdown-item" href="../articles/get_area.html">Get areas and data to layer on a map</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/elipousson/mapbaltimore/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>

        
        
        
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Get areas and data to layer on a map</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/elipousson/mapbaltimore/blob/HEAD/vignettes/articles/get_area.Rmd" class="external-link"><code>vignettes/articles/get_area.Rmd</code></a></small>
      <div class="d-none name"><code>get_area.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/elipousson/mapbaltimore" class="external-link">mapbaltimore</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="../reference/set_map_theme.html">set_map_theme</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Using the mapbaltimore package starts with understanding three key
functions:</p>
<ul>
<li>
<code><a href="../reference/get_area.html">get_area()</a></code>: Returns selected boundary data.</li>
<li>
<code><a href="../reference/get_area_data.html">get_area_data()</a></code>: Returns data for an area.</li>
<li>
<code><a href="../reference/layer_area_data.html">layer_area_data()</a></code>: Wraps <code><a href="../reference/get_area_data.html">get_area_data()</a></code>
to create a ggplot2 layer using <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">ggplot2::geom_sf()</a></code>.</li>
</ul>
<p>To show how these different functions work, I’ll make a simple
<code>map_area</code> function we will use in this article.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map_area</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">col</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level2">
<h2 id="get-areas">Get areas<a class="anchor" aria-label="anchor" href="#get-areas"></a>
</h2>
<p>The <code>get_area</code> function uses the
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code> to select one or more areas of a specified
type of political or administrative geography. You can select any one of
the seven different types:</p>
<ul>
<li>Neighborhoods</li>
<li>Baltimore City Council districts</li>
<li>Maryland state legislative districts</li>
<li>U.S. Congressional districts that include Baltimore City</li>
<li>Baltimore City Planning Districts</li>
<li>Baltimore City Police Districts</li>
<li>Baltimore City Community Statistical Areas</li>
</ul>
<div class="section level3">
<h3 id="get-areas-by-name-or-id">Get areas by name or id<a class="anchor" aria-label="anchor" href="#get-areas-by-name-or-id"></a>
</h3>
<p>You can review the names (<code>name</code>) or identifiers
(<code>id</code>) for each type of area by looking at the corresponding
column in the data. Typically, the name column should also work as a
label for an area and the id column is used as a unique identifier. The
names require an exact match. For example,
<code>get_area(type = "neighborhood", area_name = "Washington Village/Pigtown")</code>
works but
<code>get_area(type = "neighborhood", area_name = "Pigtown")</code> will
return an error.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Show the first 3 council district names</span>
<span class="va">council_districts</span><span class="op">$</span><span class="va">name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>
<span class="co">#&gt; [1] "District 8" "District 7" "District 6"</span>

<span class="co"># Get district 8 by name</span>
<span class="fu"><a href="../reference/get_area.html">get_area</a></span><span class="op">(</span>
  type <span class="op">=</span> <span class="st">"council district"</span>,
  area_name <span class="op">=</span> <span class="st">"District 8"</span>
<span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">map_area</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span></code></pre></div>
<p><img src="get_area_files/figure-html/name-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Show the first 3 council district ids</span>
<span class="va">council_districts</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>
<span class="co">#&gt; [1] "8" "7" "6"</span>

<span class="co"># Get district 7 by id</span>
<span class="fu"><a href="../reference/get_area.html">get_area</a></span><span class="op">(</span>
  type <span class="op">=</span> <span class="st">"council district"</span>,
  area_id <span class="op">=</span> <span class="fl">7</span>
<span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">map_area</span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span></code></pre></div>
<p><img src="get_area_files/figure-html/name-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="get-multiple-areas">Get multiple areas<a class="anchor" aria-label="anchor" href="#get-multiple-areas"></a>
</h3>
<p>To return multiple areas, you can provide a vector of names or
identifiers.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">area_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_area.html">get_area</a></span><span class="op">(</span>
  type <span class="op">=</span> <span class="st">"neighborhood"</span>,
  area_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mount Vernon"</span>, <span class="st">"Mid-Town Belvedere"</span>, <span class="st">"Seton Hill"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">area_multiple</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">map_area</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span></code></pre></div>
<p><img src="get_area_files/figure-html/multi-1.png" width="700"></p>
<p>You can also combine multiple areas into a single simple feature
using the <code>union</code> parameter. This is helpful when you want to
get data for multiple neighborhoods at the same time or map them as a
single combined area.</p>
<p>By default the area names are concatenated using a ampersand
separator, however, the length of these combined names are difficult to
fit on a map and it is often better to replace the name with a shorter
alternative.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">area_multiple_union</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_area.html">get_area</a></span><span class="op">(</span>
  type <span class="op">=</span> <span class="st">"neighborhood"</span>,
  area_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mount Vernon"</span>, <span class="st">"Mid-Town Belvedere"</span>, <span class="st">"Seton Hill"</span><span class="op">)</span>,
  union <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="va">area_multiple_union</span><span class="op">$</span><span class="va">name</span>
<span class="co">#&gt; [1] "Mid-Town Belvedere, Mount Vernon, and Seton Hill"</span>

<span class="va">area_multiple_union</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="st">"Mount Vernon area"</span>

<span class="va">area_multiple_union</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">map_area</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span></code></pre></div>
<p><img src="get_area_files/figure-html/multi_union-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="get-data-for-an-area">Get data for an area<a class="anchor" aria-label="anchor" href="#get-data-for-an-area"></a>
</h2>
<p>The <code><a href="../reference/get_area_data.html">get_area_data()</a></code> function offers a great deal of
flexibility. You can provide an area from <code><a href="../reference/get_area.html">get_area()</a></code> or any
other simple feature polygon or multipolygon located within Baltimore
City (or any region if using cached <code>baltimore_msa_streets</code>
data set). You can also provide a bounding box created with the
<code><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">sf::st_bbox()</a></code> function.</p>
<p>To illustrate the options for this function, I’m getting the downtown
neighborhood as a simple feature object (<code>area</code>) and making a
list with ggplot2 layers, guide, and scale (<code>area_layer</code>)
that I reuse below for the example maps in this section.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">area</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_area.html">get_area</a></span><span class="op">(</span>
  type <span class="op">=</span> <span class="st">"neighborhood"</span>,
  area_name <span class="op">=</span> <span class="st">"Downtown"</span>
<span class="op">)</span>

<span class="va">area_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area</span>, fill <span class="op">=</span> <span class="st">"grey90"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"grey20"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span>,
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf_label</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="adjust-the-area-bounding-box">Adjust the area bounding box<a class="anchor" aria-label="anchor" href="#adjust-the-area-bounding-box"></a>
</h3>
<p>In order to place an area in context, you may want a portion of data
for the surrounding area so the function returns data within the
bounding box of the area by default. The dimensions of this bounding box
can be adjusted using the <code>dist</code>, <code>diag_ratio</code>,
and <code>asp</code> parameters. You can access these adjustments
directly using the <code><a href="../reference/buffer_area.html">buffer_area()</a></code>,
<code><a href="../reference/adjust_bbox_asp.html">adjust_bbox_asp()</a></code>, and <code><a href="../reference/adjust_bbox.html">adjust_bbox()</a></code>
functions. These functions are used below to illustrate how they work
when you use the corresponding parameters with
<code><a href="../reference/get_area_data.html">get_area_data()</a></code>.</p>
<p>The <code>dist</code> parameter is passed to the
<code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">sf::st_buffer()</a></code> function and is used to set the buffer in
meters for the area. The <code>diag_ratio</code> is also used to set a
buffer distances but the number represents the proportion of the
diagonal distance of the area bounding box. This is helpful because a
set ratio will scale in proportion to the size of the area.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_dist</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">example_diag_ratio</span> <span class="op">&lt;-</span> <span class="fl">0.25</span>

<span class="co"># 50 meter buffer</span>
<span class="va">area_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buffer_area.html">buffer_area</a></span><span class="op">(</span><span class="va">area</span>, dist <span class="op">=</span> <span class="va">example_dist</span><span class="op">)</span>
<span class="va">area_dist_bbox</span> <span class="op">&lt;-</span> <span class="fu">sfext</span><span class="fu">::</span><span class="fu"><a href="https://elipousson.github.io/sfext/reference/sf_bbox_misc.html" class="external-link">sf_bbox_to_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">area_dist</span><span class="op">)</span><span class="op">)</span>

<span class="co"># buffer 1/4 (0.25) of the diagonal distance of the bounding box</span>
<span class="va">area_diag_ratio</span> <span class="op">&lt;-</span> <span class="fu">sfext</span><span class="fu">::</span><span class="fu"><a href="https://elipousson.github.io/sfext/reference/st_buffer_ext.html" class="external-link">st_buffer_ext</a></span><span class="op">(</span><span class="va">area</span>, diag_ratio <span class="op">=</span> <span class="va">example_diag_ratio</span><span class="op">)</span>
<span class="va">area_diag_ratio_bbox</span> <span class="op">&lt;-</span> <span class="fu">sfext</span><span class="fu">::</span><span class="fu"><a href="https://elipousson.github.io/sfext/reference/sf_bbox_misc.html" class="external-link">sf_bbox_to_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">area_diag_ratio</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_dist</span>, fill <span class="op">=</span> <span class="st">"purple"</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_dist_bbox</span>, color <span class="op">=</span> <span class="st">"purple"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_diag_ratio</span>, fill <span class="op">=</span> <span class="st">"darkorange"</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_diag_ratio_bbox</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">area_layer</span></code></pre></div>
<p><img src="get_area_files/figure-html/diag_ratio_example-1.png" width="700"></p>
<p>The <code>asp</code> parameter is applied after any buffers are
applied. The <code><a href="../reference/adjust_bbox_asp.html">adjust_bbox_asp()</a></code> function accepts either a
number, e.g. 1.5, or a string in the format most commonly used for
aspect ratios, e.g. “6:4”. This example shows the extent of a square
bounding box for both the buffered downtown areas created above.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_asp</span> <span class="op">&lt;-</span> <span class="st">"1:1"</span>

<span class="va">area_dist_asp</span> <span class="op">&lt;-</span> <span class="fu">sfext</span><span class="fu">::</span><span class="fu"><a href="https://elipousson.github.io/sfext/reference/st_bbox_ext.html" class="external-link">st_bbox_asp</a></span><span class="op">(</span><span class="va">area_dist</span>, asp <span class="op">=</span> <span class="va">example_asp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sfext</span><span class="fu">::</span><span class="fu"><a href="https://elipousson.github.io/sfext/reference/sf_bbox_misc.html" class="external-link">sf_bbox_to_sf</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">area_diag_ratio_asp</span> <span class="op">&lt;-</span> <span class="fu">sfext</span><span class="fu">::</span><span class="fu"><a href="https://elipousson.github.io/sfext/reference/st_bbox_ext.html" class="external-link">st_bbox_asp</a></span><span class="op">(</span><span class="va">area_diag_ratio</span>, asp <span class="op">=</span> <span class="va">example_asp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sfext</span><span class="fu">::</span><span class="fu"><a href="https://elipousson.github.io/sfext/reference/sf_bbox_misc.html" class="external-link">sf_bbox_to_sf</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_dist_asp</span>, fill <span class="op">=</span> <span class="st">"purple"</span>, color <span class="op">=</span> <span class="st">"purple"</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_diag_ratio_asp</span>, fill <span class="op">=</span> <span class="st">"darkorange"</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">area_layer</span></code></pre></div>
<p><img src="get_area_files/figure-html/asp_example-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="cropping-and-trimming-data">Cropping and trimming data<a class="anchor" aria-label="anchor" href="#cropping-and-trimming-data"></a>
</h3>
<p>Finally, here is how these area adjustments work in combination with
the <code><a href="../reference/get_area_data.html">get_area_data()</a></code> function. By default, the data is
cropped to the bounding box of the provided area:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="va">area</span>,
  data <span class="op">=</span> <span class="va">council_districts</span>
<span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">map_area</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">area_layer</span></code></pre></div>
<p><img src="get_area_files/figure-html/get_data_example-1.png" width="700"></p>
<p>Here is the data with a <code>diag_ratio</code> buffer:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="va">area</span>,
  data <span class="op">=</span> <span class="va">council_districts</span>,
  diag_ratio <span class="op">=</span> <span class="va">example_diag_ratio</span>
<span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">map_area</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">area_layer</span></code></pre></div>
<p><img src="get_area_files/figure-html/get_data_diag_ratio-1.png" width="700"></p>
<p>Here is the data using an <code>asp</code> adjustment to return a
square :</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="va">area</span>,
  data <span class="op">=</span> <span class="va">council_districts</span>,
  asp <span class="op">=</span> <span class="va">example_asp</span>
<span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">map_area</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">area_layer</span></code></pre></div>
<p><img src="get_area_files/figure-html/get_data_asp-1.png" width="700"></p>
<p>You can also avoid cropping if you want to return the full extent of
any data that even partially overlaps with the area or bounding box. For
example, this is the same example as above with
<code>crop = FALSE</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="va">area</span>,
  data <span class="op">=</span> <span class="va">council_districts</span>,
  crop <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">map_area</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">area_layer</span></code></pre></div>
<p><img src="get_area_files/figure-html/crop_false-1.png" width="700"></p>
<p>If you want to use <code>crop = FALSE</code> in combination with the
area adjustment parameters you must either supply a bounding box instead
of an area <em>or</em> adjust the area using <code><a href="../reference/buffer_area.html">buffer_area()</a></code>
before passing it to the <code><a href="../reference/get_area_data.html">get_area_data()</a></code> function. The maps
are similar enough to the prior example that I’ve hid the results but
provided the code here as a sample.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="fu">sfext</span><span class="fu">::</span><span class="fu"><a href="https://elipousson.github.io/sfext/reference/st_buffer_ext.html" class="external-link">st_buffer_ext</a></span><span class="op">(</span><span class="va">area</span>, diag_ratio <span class="op">=</span> <span class="va">example_diag_ratio</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">council_districts</span>,
  crop <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
  bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">council_districts</span>,
  diag_ratio <span class="op">=</span> <span class="va">example_diag_ratio</span>,
  crop <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<p>Depending on the type of data you are working with, you may also want
to trim the data to the area using the
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">sf::st_intersection()</a></code> function. You can’t trim to an area
if you only provide a bounding box (<code>bbox</code>); you must provide
an area.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">area_trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
  bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,
  extdata <span class="op">=</span> <span class="st">"trees"</span>,
  dist <span class="op">=</span> <span class="va">example_dist</span>
<span class="op">)</span>
<span class="co">#&gt; Reading layer `trees' from data source </span>
<span class="co">#&gt;   `/private/var/folders/3f/50m42dx1333_dfqb5772j6_40000gn/T/Rtmpys5Z3S/temp_libpath5f71373ec142/mapbaltimore/extdata/trees.gpkg' </span>
<span class="co">#&gt;   using driver `GPKG'</span>
<span class="co">#&gt; Simple feature collection with 1675 features and 15 fields (with 1 geometry empty)</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 432400.8 ymin: 179937.8 xmax: 434147.1 ymax: 180891.7</span>
<span class="co">#&gt; Projected CRS: NAD83(HARN) / Maryland</span>

<span class="va">area_trees_trimmed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="va">area</span>,
  extdata <span class="op">=</span> <span class="st">"trees"</span>,
  dist <span class="op">=</span> <span class="va">example_dist</span>,
  trim <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="co">#&gt; Reading layer `trees' from data source </span>
<span class="co">#&gt;   `/private/var/folders/3f/50m42dx1333_dfqb5772j6_40000gn/T/Rtmpys5Z3S/temp_libpath5f71373ec142/mapbaltimore/extdata/trees.gpkg' </span>
<span class="co">#&gt;   using driver `GPKG'</span>
<span class="co">#&gt; Simple feature collection with 1675 features and 15 fields (with 1 geometry empty)</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 432400.8 ymin: 179937.8 xmax: 434147.1 ymax: 180891.7</span>
<span class="co">#&gt; Projected CRS: NAD83(HARN) / Maryland</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">area_layer</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_trees</span>, color <span class="op">=</span> <span class="st">"wheat3"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_trees_trimmed</span>, color <span class="op">=</span> <span class="st">"forestgreen"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p><img src="get_area_files/figure-html/trim_example-1.png" width="700"></p>
<p>Similar to crop, using the <code>trim = TRUE</code> parameter ignores
any distance adjustments but the same work around can be used to apply a
buffer to the area before passing it to
<code><a href="../reference/get_area_data.html">get_area_data()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">area_trees_trimmed_diag_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="fu"><a href="../reference/buffer_area.html">buffer_area</a></span><span class="op">(</span><span class="va">area</span>, diag_ratio <span class="op">=</span> <span class="va">example_diag_ratio</span><span class="op">)</span>,
  extdata <span class="op">=</span> <span class="st">"trees"</span>,
  trim <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="co">#&gt; Reading layer `trees' from data source </span>
<span class="co">#&gt;   `/private/var/folders/3f/50m42dx1333_dfqb5772j6_40000gn/T/Rtmpys5Z3S/temp_libpath5f71373ec142/mapbaltimore/extdata/trees.gpkg' </span>
<span class="co">#&gt;   using driver `GPKG'</span>
<span class="co">#&gt; Simple feature collection with 5462 features and 15 fields (with 2 geometries empty)</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 431984 ymin: 179521.7 xmax: 434562.3 ymax: 181305.6</span>
<span class="co">#&gt; Projected CRS: NAD83(HARN) / Maryland</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">area_layer</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_trees_trimmed_diag_ratio</span>, color <span class="op">=</span> <span class="st">"forestgreen"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">area_trees_trimmed</span>, color <span class="op">=</span> <span class="st">"wheat3"</span><span class="op">)</span></code></pre></div>
<p><img src="get_area_files/figure-html/trim_example_alt-1.png" width="700"></p>
<p>The <code>trim</code> parameter is also supported by the
<code><a href="../reference/get_area_esri_data.html">get_area_esri_data()</a></code> and <code><a href="../reference/get_area_osm_data.html">get_area_osm_data()</a></code>
functions that are discussed in more detail in the <a href="/articles/articles/extdata_cachedata.html">article on external,
cached, and remote data sources</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="layering-data-in-area-maps">Layering data in area maps<a class="anchor" aria-label="anchor" href="#layering-data-in-area-maps"></a>
</h2>
<p>You may be wondering why these all of these parameters may be useful.
The <code><a href="../reference/layer_area_data.html">layer_area_data()</a></code> function combines
<code><a href="../reference/get_area_data.html">get_area_data()</a></code> with <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">ggplot2::geom_sf()</a></code> to
quickly turn the data from <code>mapbaltimore</code> into ggplot maps.
Here is a simple example that turns streets and parks data into a map of
the downtown area.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_diag_ratio</span> <span class="op">&lt;-</span> <span class="fl">0.05</span>

<span class="va">layer_streets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/layer_area_data.html">layer_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="va">area</span>,
  data <span class="op">=</span> <span class="va">streets</span>,
  color <span class="op">=</span> <span class="st">"gray60"</span>,
  diag_ratio <span class="op">=</span> <span class="va">example_diag_ratio</span>
<span class="op">)</span>

<span class="va">layer_parks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/layer_area_data.html">layer_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="va">area</span>,
  data <span class="op">=</span> <span class="va">parks</span>,
  fill <span class="op">=</span> <span class="st">"forestgreen"</span>,
  diag_ratio <span class="op">=</span> <span class="va">example_diag_ratio</span>
<span class="op">)</span>

<span class="va">background_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">layer_streets</span>, <span class="va">layer_parks</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">background_layers</span></code></pre></div>
<p><img src="get_area_files/figure-html/layer_area_data-1.png" width="700"></p>
<p>Like <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">ggplot2::geom_sf()</a></code>, <code><a href="../reference/layer_area_data.html">layer_area_data()</a></code>
can inherit data from <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> and allows users to set
aesthetics using the <code>mapping</code> parameter. Other ggplot2
objects such as scales, labels, and guides can be combined with a data
layer by providing a list to the <code>layer_after</code> parameter. The
<code>show_area</code> option also provides a convenient way to overlay
the boundaries of the area and the <code>area_aes</code> parameter
allows you to passed custom fixed aesthetics to the area layer. This
following example showing the BCPSS elementary school attendance zones
around downtown illustrates how these parameters work.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/layer_area_data.html">layer_area_data</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">bcps_zones</span>,
    area <span class="op">=</span> <span class="va">area</span>,
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">program_name_short</span><span class="op">)</span>,
    diag_ratio <span class="op">=</span> <span class="fl">0.25</span>,
    asp <span class="op">=</span> <span class="va">example_asp</span>,
    show_area <span class="op">=</span> <span class="cn">TRUE</span>,
    area_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, size <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span>,
    layer_after <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span>,
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Zoning category"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p><img src="get_area_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>If you want to use data from one of the remote data functions, you
can set the <code>asis</code> parameter to <code>TRUE</code> indicating
that the data is already matched to the area and does not require any
additional adjustments. For example, the following example shows how to
create a new map layer using data imported from Open Street Map.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">layer_area_buildings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/layer_area_data.html">layer_area_data</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="fu"><a href="../reference/get_area_osm_data.html">get_area_osm_data</a></span><span class="op">(</span>
    area <span class="op">=</span> <span class="va">area</span>,
    diag_ratio <span class="op">=</span> <span class="va">example_diag_ratio</span>,
    key <span class="op">=</span> <span class="st">"building"</span>,
    value <span class="op">=</span> <span class="st">"yes"</span>
  <span class="op">)</span>,
  asis <span class="op">=</span> <span class="cn">TRUE</span>,
  fill <span class="op">=</span> <span class="st">"antiquewhite2"</span>,
  color <span class="op">=</span> <span class="cn">NA</span>,
  alpha <span class="op">=</span> <span class="fl">1</span>,
  layer_after <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"© OpenStreetMap contributors"</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; Error in curl::curl_fetch_memory(url, handle = handle): HTTP/2 stream 0 was not closed cleanly: PROTOCOL_ERROR (err 1)</span>
<span class="co">#&gt; Request failed [ERROR]. Retrying in 1 seconds...</span>
<span class="co">#&gt; Error in curl::curl_fetch_memory(url, handle = handle): HTTP/2 stream 0 was not closed cleanly: PROTOCOL_ERROR (err 1)</span>
<span class="co">#&gt; Request failed [ERROR]. Retrying in 3.2 seconds...</span>
<span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout all</span>
<span class="co">#&gt; geometries</span>
<span class="co">#&gt; Open Street Map data is available under the Open Database Licence which requires attribution. See https://www.openstreetmap.org/copyright for more information.</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">background_layers</span> <span class="op">+</span>
  <span class="va">layer_area_buildings</span></code></pre></div>
<p><img src="get_area_files/figure-html/layer_area_osm-1.png" width="700"></p>
<p>You can also use the <code>url</code> parameter that is passed to
<code>get_area_esri_data</code> to add data from any ArcGIS MapServer or
FeatureServer. A local shapefile can be imported using the
<code>path</code> parameter.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parking_facility_url</span> <span class="op">&lt;-</span> <span class="st">"https://opendata.baltimorecity.gov/egis/rest/services/Hosted/Parking_Facilities/FeatureServer/0"</span>

<span class="va">layer_area_parking</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/layer_area_data.html">layer_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="va">area</span>,
  url <span class="op">=</span> <span class="va">parking_facility_url</span>,
  diag_ratio <span class="op">=</span> <span class="va">example_diag_ratio</span>,
  color <span class="op">=</span> <span class="st">"gray10"</span>,
  fill <span class="op">=</span> <span class="st">"yellow"</span>,
  shape <span class="op">=</span> <span class="fl">24</span>,
  size <span class="op">=</span> <span class="fl">4</span>,
  layer_after <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Parking facilities in Downtown Baltimore"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> Downloading <span style="color: #0000BB;">"Parking_Facilities"</span> from</span>
<span class="co">#&gt;   <span style="color: #0000BB; font-style: italic;">&lt;</span></span>
<span class="co"><span style="color: #0000BB; font-style: italic;">#&gt; Layer type: "Feature Layer"</span></span>
<span class="co"><span style="font-style: italic;">#&gt; </span></span>
<span class="co"><span style="font-style: italic;">#&gt; Geometry type: </span><span style="color: #0000BB; font-style: italic;">"esriGeometryPoint"</span></span>
<span class="co"><span style="font-style: italic;">#&gt; </span></span>
<span class="co"><span style="font-style: italic;">#&gt; Service CRS: </span><span style="color: #0000BB; font-style: italic;">"EPSG:3857"</span></span>
<span class="co"><span style="font-style: italic;">#&gt; </span></span>
<span class="co"><span style="font-style: italic;">#&gt; Output CRS: </span><span style="color: #0000BB; font-style: italic;">"EPSG:4326"</span></span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">background_layers</span> <span class="op">+</span>
  <span class="va">layer_area_buildings</span> <span class="op">+</span>
  <span class="va">layer_area_parking</span></code></pre></div>
<p><img src="get_area_files/figure-html/layer_area_url-1.png" width="700"></p>
<p>Finally, you can apply some additional function to the data using the
same lambda syntax used for <code>purrr</code>. For example, the tree
data includes dead trees which could be removed before displaying them
on a map.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">layer_area_trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/layer_area_data.html">layer_area_data</a></span><span class="op">(</span>
  area <span class="op">=</span> <span class="va">area</span>,
  extdata <span class="op">=</span> <span class="st">"trees"</span>,
  fn <span class="op">=</span> <span class="op">~</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">condition</span> <span class="op">!=</span> <span class="st">"Dead"</span><span class="op">)</span>,
  trim <span class="op">=</span> <span class="cn">TRUE</span>,
  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>
    size <span class="op">=</span> <span class="va">dbh</span> <span class="op">*</span> <span class="fl">0.4</span>,
    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">condition</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Good"</span>, <span class="st">"Fair"</span>, <span class="st">"Poor"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  alpha <span class="op">=</span> <span class="fl">0.6</span>,
  layer_after <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Tree condition"</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">shades</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shades/man/gradient.html" class="external-link">gradient</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"forestgreen"</span>, <span class="st">"burlywood4"</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; Reading layer `trees' from data source </span>
<span class="co">#&gt;   `/private/var/folders/3f/50m42dx1333_dfqb5772j6_40000gn/T/Rtmpys5Z3S/temp_libpath5f71373ec142/mapbaltimore/extdata/trees.gpkg' </span>
<span class="co">#&gt;   using driver `GPKG'</span>
<span class="co">#&gt; Simple feature collection with 1422 features and 15 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 432451.5 ymin: 179986.2 xmax: 434095.1 ymax: 180841.6</span>
<span class="co">#&gt; Projected CRS: NAD83(HARN) / Maryland</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">background_layers</span> <span class="op">+</span>
  <span class="va">layer_area_trees</span></code></pre></div>
<p><img src="get_area_files/figure-html/layer_area_trees_f-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="working-with-multiple-areas">Working with multiple areas<a class="anchor" aria-label="anchor" href="#working-with-multiple-areas"></a>
</h2>
<p>There are a few different ways to use these functions with a
dataframe of multiple areas. The <code><a href="../reference/get_area_data.html">get_area_data()</a></code> function
always combines multiple areas into a single geometry and returns data
for a bounding box that encompasses all areas.</p>
<p>If you want to get data for each area separately, the
<code><a href="https://dplyr.tidyverse.org/reference/nest_by.html" class="external-link">dplyr::nest_by()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map_dfr()</a></code>
functions can be used. The following example also shows how
<code><a href="../reference/get_nearby_areas.html">get_nearby_areas()</a></code> can be used to return a data frame of
overlapping or immediately surrounding areas.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nearby_areas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_nearby_areas.html">get_nearby_areas</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">area</span>, type <span class="op">=</span> <span class="st">"neighborhood"</span><span class="op">)</span>

<span class="va">nearby_areas_nested</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nest_by.html" class="external-link">nest_by</a></span><span class="op">(</span><span class="va">nearby_areas</span>, <span class="va">name</span>, .keep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">nearby_parks</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span>
  <span class="va">nearby_areas_nested</span><span class="op">$</span><span class="va">data</span>,
  <span class="op">~</span> <span class="fu"><a href="../reference/get_area_data.html">get_area_data</a></span><span class="op">(</span>
    area <span class="op">=</span> <span class="va">.x</span>,
    data <span class="op">=</span> <span class="va">parks</span>,
    trim <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_cols</a></span><span class="op">(</span>neighborhood <span class="op">=</span> <span class="va">.x</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/layer_area_data.html">layer_area_data</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">nearby_areas</span>, data <span class="op">=</span> <span class="va">streets</span>, trim <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="st">"gray70"</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">layer_parks</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nearby_parks</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">neighborhood</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Neighborhood\nof park"</span><span class="op">)</span></code></pre></div>
<p><img src="get_area_files/figure-html/nearby_areas_nested-1.png" width="700"></p>
<p>Another approach relies on using the data inherited from
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> with the option to apply different aesthetics or
process the data differently in each layer of the map.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parks</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/layer_area_data.html">layer_area_data</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">area</span>, trim <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">"forestgreen"</span>, show_area <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/layer_area_data.html">layer_area_data</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">nearby_areas</span><span class="op">[</span><span class="fl">6</span>, <span class="op">]</span>, trim <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">"yellowgreen"</span>, show_area <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="get_area_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="copyright">
  <p></p>
<p>Developed by Eli Pousson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
